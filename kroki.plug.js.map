{
  "version": 3,
  "sources": ["https://deno.land/x/silverbullet@2.4.1/plug-api/lib/crypto.ts", "https://deno.land/x/silverbullet@2.4.1/client/lib/logger.ts", "https://deno.land/x/silverbullet@2.4.1/client/plugos/worker_runtime.ts", "https://jsr.io/@silverbulletmd/silverbullet/2.4.1/plug-api/syscall.ts", "https://jsr.io/@silverbulletmd/silverbullet/2.4.1/plug-api/syscalls/system.ts", "https://jsr.io/@silverbulletmd/silverbullet/2.4.1/plug-api/lib/crypto.ts", "krokiConfig.ts", "krokiBackend.ts", "kroki.ts", "../../../../../tmp/e30df4c42329cdda.js"],
  "sourcesContent": ["export function base64Decode(s: string): Uint8Array {\n  const binString = atob(s);\n  const len = binString.length;\n  const bytes = new Uint8Array(len);\n  for (let i = 0; i < len; i++) {\n    bytes[i] = binString.charCodeAt(i);\n  }\n  return bytes;\n}\n\nexport function base64Encode(buffer: Uint8Array | string): string {\n  if (typeof buffer === \"string\") {\n    buffer = new TextEncoder().encode(buffer);\n  }\n  let binary = \"\";\n  const len = buffer.byteLength;\n  for (let i = 0; i < len; i++) {\n    binary += String.fromCharCode(buffer[i]);\n  }\n  return btoa(binary);\n}\n\nexport function base64EncodedDataUrl(\n  mimeType: string,\n  buffer: Uint8Array,\n): string {\n  return `data:${mimeType};base64,${base64Encode(buffer)}`;\n}\n\nexport function base64DecodeDataUrl(dataUrl: string): Uint8Array {\n  const b64Encoded = dataUrl.split(\",\", 2)[1];\n  return base64Decode(b64Encoded);\n}\n\n/**\n * Perform sha256 hash using the browser's crypto APIs\n * Note: this will only work over HTTPS\n * @param message\n */\nexport async function hashSHA256(\n  message: string | Uint8Array,\n): Promise<string> {\n  // Transform the string into an ArrayBuffer\n  const encoder = new TextEncoder();\n  const data: Uint8Array = typeof message === \"string\"\n    ? encoder.encode(message)\n    : message;\n\n  // Generate the hash\n  const hashBuffer = await globalThis.crypto.subtle.digest(\n    \"SHA-256\",\n    data as BufferSource,\n  );\n\n  // Transform the hash into a hex string\n  return Array.from(new Uint8Array(hashBuffer)).map((b) =>\n    b.toString(16).padStart(2, \"0\")\n  ).join(\"\");\n}\n\n/**\n * To avoid database clashes based on space folder path name, base URLs and encryption keys we derive\n * a database name from a hash of all these combined together\n */\nexport async function deriveDbName(\n  type: \"data\" | \"files\",\n  spaceFolderPath: string,\n  baseURI: string,\n  encryptionKey?: CryptoKey,\n): Promise<string> {\n  let keyPart = \"\";\n  if (encryptionKey) {\n    keyPart = await exportKey(encryptionKey);\n  }\n  const spaceHash = await hashSHA256(\n    `${spaceFolderPath}:${baseURI}:${keyPart}`,\n  );\n  return `sb_${type}_${spaceHash}`;\n}\n\n// Fixed counter for AES-CTR all zeroes, for determinism\nconst fixedCounter = new Uint8Array(16);\n\nexport async function encryptStringDeterministic(\n  key: CryptoKey,\n  clearText: string,\n): Promise<string> {\n  const encrypted = await crypto.subtle.encrypt(\n    { name: \"AES-CTR\", counter: fixedCounter, length: fixedCounter.length * 8 },\n    key,\n    new TextEncoder().encode(clearText),\n  );\n  return base64Encode(new Uint8Array(encrypted));\n}\n\nexport async function decryptStringDeterministic(\n  key: CryptoKey,\n  cipherText: string,\n): Promise<string> {\n  const decrypted = await crypto.subtle.decrypt(\n    { name: \"AES-CTR\", counter: fixedCounter, length: fixedCounter.length * 8 },\n    key,\n    base64Decode(cipherText) as BufferSource,\n  );\n  return new TextDecoder().decode(decrypted);\n}\n\n// Encrypt using AES-GCM with random IV; output = IV + ciphertext\nexport async function encryptAesGcm(\n  key: CryptoKey,\n  data: Uint8Array,\n): Promise<Uint8Array> {\n  const iv = crypto.getRandomValues(new Uint8Array(12)); // 96-bit IV recommended for GCM\n  const encryptedBuffer = await crypto.subtle.encrypt(\n    { name: \"AES-GCM\", iv },\n    key,\n    data as BufferSource,\n  );\n  const encrypted = new Uint8Array(encryptedBuffer);\n\n  // Prepend IV to ciphertext\n  const result = new Uint8Array(iv.length + encrypted.length);\n  result.set(iv, 0);\n  result.set(encrypted, iv.length);\n  return result;\n}\n\n// Decrypt using AES-GCM assuming input format IV + ciphertext\nexport async function decryptAesGcm(\n  key: CryptoKey,\n  encryptedData: Uint8Array,\n): Promise<Uint8Array> {\n  const iv = encryptedData.slice(0, 12); // extract IV (first 12 bytes)\n  const ciphertext = encryptedData.slice(12);\n  const decryptedBuffer = await crypto.subtle.decrypt(\n    { name: \"AES-GCM\", iv },\n    key,\n    ciphertext,\n  );\n  return new Uint8Array(decryptedBuffer);\n}\n\nexport async function deriveCTRKeyFromPassword(\n  password: string,\n  salt: Uint8Array,\n): Promise<CryptoKey> {\n  // Encode password to ArrayBuffer\n  const passwordBytes = new TextEncoder().encode(password);\n\n  // Import password as a CryptoKey\n  const baseKey = await crypto.subtle.importKey(\n    \"raw\",\n    passwordBytes,\n    { name: \"PBKDF2\" },\n    false,\n    [\"deriveBits\", \"deriveKey\"],\n  );\n\n  return crypto.subtle.deriveKey(\n    {\n      name: \"PBKDF2\",\n      salt: salt as BufferSource,\n      iterations: 100000,\n      hash: \"SHA-256\",\n    },\n    baseKey,\n    {\n      name: \"AES-CTR\",\n      length: 256,\n    },\n    true, // extractable\n    [\"encrypt\", \"decrypt\"],\n  );\n}\n\nexport function importKey(b64EncodedKey: string): Promise<CryptoKey> {\n  return crypto.subtle.importKey(\n    \"raw\",\n    base64Decode(b64EncodedKey) as BufferSource,\n    { name: \"AES-CTR\" },\n    true,\n    [\"encrypt\", \"decrypt\"],\n  );\n}\n\nexport async function exportKey(ctrKey: CryptoKey): Promise<string> {\n  const key = await crypto.subtle.exportKey(\"raw\", ctrKey);\n  return base64Encode(new Uint8Array(key));\n}\n\nexport async function deriveGCMKeyFromCTR(\n  ctrKey: CryptoKey,\n): Promise<CryptoKey> {\n  const rawKey = await crypto.subtle.exportKey(\"raw\", ctrKey);\n  return crypto.subtle.importKey(\n    \"raw\",\n    rawKey,\n    { name: \"AES-GCM\" },\n    true,\n    [\"encrypt\", \"decrypt\"],\n  );\n}\n", "// Logger that monkey patches console methods with prefixes and can capture logs for server transmission\n\nexport interface LogEntry {\n  level: \"log\" | \"info\" | \"warn\" | \"error\" | \"debug\";\n  timestamp: number;\n  message: string;\n}\n\nexport class Logger {\n  private originalConsole: {\n    log: typeof console.log;\n    info: typeof console.info;\n    warn: typeof console.warn;\n    error: typeof console.error;\n    debug: typeof console.debug;\n  };\n  public logBuffer: LogEntry[] = [];\n\n  constructor(\n    private prefix: string = \"\",\n    private maxCaptureSize: number = 1000,\n  ) {\n    this.prefix = prefix;\n\n    // Store original console methods\n    this.originalConsole = {\n      log: console.log.bind(console),\n      info: console.info.bind(console),\n      warn: console.warn.bind(console),\n      error: console.error.bind(console),\n      debug: console.debug.bind(console),\n    };\n\n    this.patchConsole();\n  }\n\n  private patchConsole(): void {\n    const createPatchedMethod = (level: keyof typeof this.originalConsole) => {\n      return (...args: any[]) => {\n        const prefixedArgs = this.prefix ? [this.prefix, ...args] : args;\n\n        // Call original console method\n        this.originalConsole[level](...prefixedArgs);\n\n        // Capture log if capturing is enabled\n        this.captureLog(level, args);\n      };\n    };\n\n    console.log = createPatchedMethod(\"log\");\n    console.info = createPatchedMethod(\"info\");\n    console.warn = createPatchedMethod(\"warn\");\n    console.error = createPatchedMethod(\"error\");\n    console.debug = createPatchedMethod(\"debug\");\n  }\n\n  private captureLog(level: LogEntry[\"level\"], args: any[]): void {\n    const entry: LogEntry = {\n      level,\n      timestamp: Date.now(),\n      message: args.map((arg) => {\n        if (typeof arg === \"string\") {\n          return arg;\n        }\n        try {\n          return JSON.stringify(arg);\n        } catch {\n          // Handle circular references or other JSON.stringify failures\n          return String(arg);\n        }\n      }).join(\" \"),\n    };\n\n    this.logBuffer.push(entry);\n\n    // Maintain max capture size by removing oldest entries\n    if (this.logBuffer.length > this.maxCaptureSize) {\n      this.logBuffer.shift();\n    }\n  }\n\n  /**\n   * Posts all buffered logs to a server endpoint\n   */\n  async postToServer(logEndpoint: string, source: string) {\n    const logs = this.logBuffer;\n    if (logs.length > 0) {\n      // Flush the buffer\n      const logCopy = [...this.logBuffer];\n      this.logBuffer = [];\n      try {\n        const resp = await fetch(logEndpoint, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify(logCopy.map((entry) => ({ ...entry, source }))),\n        });\n        if (!resp.ok) {\n          throw new Error(\"Failed to post logs to server\");\n        }\n      } catch (e: any) {\n        console.warn(\"Could not post logs to server\", e.message);\n        // Put back the logs into the buffer\n        this.logBuffer.unshift(...logCopy);\n      }\n    }\n  }\n}\n\n// Global logger instance\nlet globalLogger: Logger | undefined = undefined;\n\nexport function initLogger(prefix: string = \"\"): Logger {\n  globalLogger = new Logger(prefix);\n  return globalLogger;\n}\n", "// This is the runtime imported from the compiled plug worker code\nimport type { ControllerMessage, WorkerMessage } from \"./protocol.ts\";\nimport type {\n  ProxyFetchRequest64,\n  ProxyFetchResponse64,\n} from \"./proxy_fetch.ts\";\nimport { base64Decode, base64Encode } from \"../../plug-api/lib/crypto.ts\";\nimport { initLogger } from \"../lib/logger.ts\";\n\ndeclare global {\n  function syscall(name: string, ...args: any[]): Promise<any>;\n}\n\nlet workerPostMessage = (_msg: ControllerMessage): void => {\n  throw new Error(\"Not initialized yet\");\n};\n\n// Are we running in a (web) worker?\n\n// Determines if we're running in a web worker environment (Deno or browser)\n// - in a browser's main threads, typeof window is \"object\"\n// - in a browser's worker threads, typeof window === \"undefined\"\n// - in Deno's main thread typeof window === \"object\"\n// - in Deno's workers typeof window === \"undefined\n// - in Cloudflare workers typeof window === \"undefined\", but typeof globalThis.WebSocketPair is defined\nconst runningAsWebWorker = typeof window === \"undefined\" &&\n  // @ts-ignore: globalThis\n  typeof globalThis.WebSocketPair === \"undefined\";\n\nif (typeof Deno === \"undefined\") {\n  // @ts-ignore: Deno hack\n  self.Deno = {\n    args: [],\n    // @ts-ignore: Deno hack\n    build: {\n      arch: \"x86_64\",\n    },\n    env: {\n      // @ts-ignore: Deno hack\n      get() {\n      },\n    },\n  };\n}\n\nconst pendingRequests = new Map<\n  number,\n  {\n    resolve: (result: unknown) => void;\n    reject: (e: any) => void;\n  }\n>();\n\nlet syscallReqId = 0;\n\nif (runningAsWebWorker) {\n  globalThis.syscall = async (name: string, ...args: any[]) => {\n    return await new Promise((resolve, reject) => {\n      syscallReqId++;\n      pendingRequests.set(syscallReqId, { resolve, reject });\n      workerPostMessage({\n        type: \"sys\",\n        id: syscallReqId,\n        name,\n        args,\n      });\n    });\n  };\n}\n\nexport function setupMessageListener(\n  // deno-lint-ignore ban-types\n  functionMapping: Record<string, Function>,\n  manifest: any,\n  postMessageFn: (msg: ControllerMessage) => void,\n) {\n  if (!runningAsWebWorker) {\n    // Don't do any of this stuff if this is not a web worker\n    // This caters to the NoSandbox run mode\n    return;\n  }\n  workerPostMessage = postMessageFn;\n  self.addEventListener(\"message\", (event: { data: WorkerMessage }) => {\n    (async () => {\n      const data = event.data;\n      switch (data.type) {\n        case \"inv\":\n          {\n            const fn = functionMapping[data.name!];\n            if (!fn) {\n              throw new Error(`Function not loaded: ${data.name}`);\n            }\n            try {\n              const result = await Promise.resolve(fn(...(data.args || [])));\n              workerPostMessage({\n                type: \"invr\",\n                id: data.id,\n                result: result,\n              } as ControllerMessage);\n            } catch (e: any) {\n              console.error(\n                \"An exception was thrown as a result of invoking function\",\n                data.name,\n                \"error:\",\n                e.message,\n              );\n              workerPostMessage({\n                type: \"invr\",\n                id: data.id!,\n                error: e.message,\n              });\n            }\n          }\n          break;\n        case \"sysr\":\n          {\n            const syscallId = data.id;\n            const lookup = pendingRequests.get(syscallId);\n            if (!lookup) {\n              throw Error(\"Invalid request id\");\n            }\n            pendingRequests.delete(syscallId);\n            if (data.error) {\n              lookup.reject(new Error(data.error));\n            } else {\n              lookup.resolve(data.result);\n            }\n          }\n\n          break;\n      }\n    })().catch(console.error);\n  });\n  // Signal initialization with manifest\n  workerPostMessage({\n    type: \"manifest\",\n    manifest,\n  });\n  initLogger(`[${manifest.name} plug]`);\n}\n\nexport async function sandboxFetch(\n  reqInfo: RequestInfo,\n  options?: ProxyFetchRequest64,\n): Promise<ProxyFetchResponse64> {\n  if (typeof reqInfo !== \"string\") {\n    const body = new Uint8Array(await reqInfo.arrayBuffer());\n    const encodedBody = body.length > 0 ? base64Encode(body) : undefined;\n    options = {\n      method: reqInfo.method,\n      headers: Object.fromEntries(reqInfo.headers.entries()),\n      base64Body: encodedBody,\n    };\n    reqInfo = reqInfo.url;\n  }\n  return syscall(\"sandboxFetch.fetch\", reqInfo, options);\n}\n\n// @ts-ignore: monkey patching fetch\nglobalThis.nativeFetch = globalThis.fetch;\n\n// Monkey patch fetch()\nexport function monkeyPatchFetch() {\n  // @ts-ignore: monkey patching fetch\n  globalThis.fetch = async function (\n    reqInfo: RequestInfo,\n    init?: RequestInit,\n  ): Promise<Response> {\n    const encodedBody = init && init.body\n      ? base64Encode(\n        new Uint8Array(await (new Response(init.body)).arrayBuffer()),\n      )\n      : undefined;\n    const r = await sandboxFetch(\n      reqInfo,\n      init && {\n        method: init.method,\n        headers: init.headers as Record<string, string>,\n        base64Body: encodedBody,\n      },\n    );\n    // Casting the response to \"any\" for now, since of weird Deno typing\n    return new Response(\n      (r.base64Body ? base64Decode(r.base64Body) : null) as any,\n      {\n        status: r.status,\n        headers: r.headers,\n      },\n    );\n  };\n}\n\nif (runningAsWebWorker) {\n  monkeyPatchFetch();\n}\n", "// declare global {\n//   function syscall(name: string, ...args: any[]): Promise<any>;\n// }\n\n// This is the case when running tests only, so giving it a dummy syscall function\nif (typeof self === \"undefined\") {\n  (self as any) = {\n    syscall: () => {\n      throw new Error(\"Not implemented here\");\n    },\n  };\n}\n\n// Late binding syscall\nexport function syscall(name: string, ...args: any[]): Promise<any> {\n  return (globalThis as any).syscall(name, ...args);\n}\n", "import { syscall } from \"../syscall.ts\";\nimport type { CommandDef } from \"../types/manifest.ts\";\nimport type { SyscallMeta } from \"../types/index.ts\";\n\n/**\n * System level syscalls\n * @module\n */\n\n/**\n * Invoke a plug function\n * @param name a string representing the name of the function to invoke (\"plug.functionName\")\n * @param args arguments to pass to the function\n * @returns\n */\nexport function invokeFunction(\n  name: string,\n  ...args: any[]\n): Promise<any> {\n  return syscall(\"system.invokeFunction\", name, ...args);\n}\n\n/**\n * Invoke a client command by name\n * Note: only available on the client\n * @param name name of the command\n * @param args arguments to pass to the command\n */\nexport function invokeCommand(name: string, args?: string[]): Promise<any> {\n  return syscall(\"system.invokeCommand\", name, args);\n}\n\n/**\n * Lists all commands available\n * @returns a map of all available commands\n */\nexport function listCommands(): Promise<Record<string, CommandDef>> {\n  return syscall(\"system.listCommands\");\n}\n\n/**\n * Lists all syscalls available\n * @returns a list of all available syscalls\n */\nexport function listSyscalls(): Promise<SyscallMeta[]> {\n  return syscall(\"system.listSyscalls\");\n}\n\n/**\n * Trigger a reload of all plugs\n * @returns\n */\nexport function reloadPlugs(): Promise<void> {\n  return syscall(\"system.reloadPlugs\");\n}\n\n/**\n * Returns the current mode of the system, either \"ro\" (read-only) or \"rw\" (read-write)\n */\nexport function getMode(): Promise<\"ro\" | \"rw\"> {\n  return syscall(\"system.getMode\");\n}\n\n/**\n * Returns the prefix set by SB_URL_PREFIX or \"/\" if the variable isn't set\n */\nexport function getURLPrefix(): Promise<string> {\n  return syscall(\"system.getURLPrefix\");\n}\n\n/**\n * Returns the base URI for this SilverBullet isntance\n */\nexport function getBaseURI(): Promise<string> {\n  return syscall(\"system.getBaseURI\");\n}\n\n/**\n * Returns the SilverBullet version\n */\nexport function getVersion(): Promise<string> {\n  return syscall(\"system.getVersion\");\n}\n\nexport function getConfig<T = any>(\n  key: string,\n  defaultValue: any = undefined,\n): Promise<T> {\n  return syscall(\"system.getConfig\", key, defaultValue);\n}\n\nexport function wipeClient(logout = false): Promise<void> {\n  return syscall(\"system.wipeClient\", logout);\n}\n\n/**\n * Deletes all IndexedDB databases that are not connected to client (e.g. legacy databases)\n */\nexport function cleanDatabases(): Promise<boolean> {\n  return syscall(\"system.cleanDatabases\");\n}\n", "export function base64Decode(s: string): Uint8Array {\n  const binString = atob(s);\n  const len = binString.length;\n  const bytes = new Uint8Array(len);\n  for (let i = 0; i < len; i++) {\n    bytes[i] = binString.charCodeAt(i);\n  }\n  return bytes;\n}\n\nexport function base64Encode(buffer: Uint8Array | string): string {\n  if (typeof buffer === \"string\") {\n    buffer = new TextEncoder().encode(buffer);\n  }\n  let binary = \"\";\n  const len = buffer.byteLength;\n  for (let i = 0; i < len; i++) {\n    binary += String.fromCharCode(buffer[i]);\n  }\n  return btoa(binary);\n}\n\nexport function base64EncodedDataUrl(\n  mimeType: string,\n  buffer: Uint8Array,\n): string {\n  return `data:${mimeType};base64,${base64Encode(buffer)}`;\n}\n\nexport function base64DecodeDataUrl(dataUrl: string): Uint8Array {\n  const b64Encoded = dataUrl.split(\",\", 2)[1];\n  return base64Decode(b64Encoded);\n}\n\n/**\n * Perform sha256 hash using the browser's crypto APIs\n * Note: this will only work over HTTPS\n * @param message\n */\nexport async function hashSHA256(\n  message: string | Uint8Array,\n): Promise<string> {\n  // Transform the string into an ArrayBuffer\n  const encoder = new TextEncoder();\n  const data: Uint8Array = typeof message === \"string\"\n    ? encoder.encode(message)\n    : message;\n\n  // Generate the hash\n  const hashBuffer = await globalThis.crypto.subtle.digest(\n    \"SHA-256\",\n    data as BufferSource,\n  );\n\n  // Transform the hash into a hex string\n  return Array.from(new Uint8Array(hashBuffer)).map((b) =>\n    b.toString(16).padStart(2, \"0\")\n  ).join(\"\");\n}\n\n/**\n * To avoid database clashes based on space folder path name, base URLs and encryption keys we derive\n * a database name from a hash of all these combined together\n */\nexport async function deriveDbName(\n  type: \"data\" | \"files\",\n  spaceFolderPath: string,\n  baseURI: string,\n  encryptionKey?: CryptoKey,\n): Promise<string> {\n  let keyPart = \"\";\n  if (encryptionKey) {\n    keyPart = await exportKey(encryptionKey);\n  }\n  const spaceHash = await hashSHA256(\n    `${spaceFolderPath}:${baseURI}:${keyPart}`,\n  );\n  return `sb_${type}_${spaceHash}`;\n}\n\n// Fixed counter for AES-CTR all zeroes, for determinism\nconst fixedCounter = new Uint8Array(16);\n\nexport async function encryptStringDeterministic(\n  key: CryptoKey,\n  clearText: string,\n): Promise<string> {\n  const encrypted = await crypto.subtle.encrypt(\n    { name: \"AES-CTR\", counter: fixedCounter, length: fixedCounter.length * 8 },\n    key,\n    new TextEncoder().encode(clearText),\n  );\n  return base64Encode(new Uint8Array(encrypted));\n}\n\nexport async function decryptStringDeterministic(\n  key: CryptoKey,\n  cipherText: string,\n): Promise<string> {\n  const decrypted = await crypto.subtle.decrypt(\n    { name: \"AES-CTR\", counter: fixedCounter, length: fixedCounter.length * 8 },\n    key,\n    base64Decode(cipherText) as BufferSource,\n  );\n  return new TextDecoder().decode(decrypted);\n}\n\n// Encrypt using AES-GCM with random IV; output = IV + ciphertext\nexport async function encryptAesGcm(\n  key: CryptoKey,\n  data: Uint8Array,\n): Promise<Uint8Array> {\n  const iv = crypto.getRandomValues(new Uint8Array(12)); // 96-bit IV recommended for GCM\n  const encryptedBuffer = await crypto.subtle.encrypt(\n    { name: \"AES-GCM\", iv },\n    key,\n    data as BufferSource,\n  );\n  const encrypted = new Uint8Array(encryptedBuffer);\n\n  // Prepend IV to ciphertext\n  const result = new Uint8Array(iv.length + encrypted.length);\n  result.set(iv, 0);\n  result.set(encrypted, iv.length);\n  return result;\n}\n\n// Decrypt using AES-GCM assuming input format IV + ciphertext\nexport async function decryptAesGcm(\n  key: CryptoKey,\n  encryptedData: Uint8Array,\n): Promise<Uint8Array> {\n  const iv = encryptedData.slice(0, 12); // extract IV (first 12 bytes)\n  const ciphertext = encryptedData.slice(12);\n  const decryptedBuffer = await crypto.subtle.decrypt(\n    { name: \"AES-GCM\", iv },\n    key,\n    ciphertext,\n  );\n  return new Uint8Array(decryptedBuffer);\n}\n\nexport async function deriveCTRKeyFromPassword(\n  password: string,\n  salt: Uint8Array,\n): Promise<CryptoKey> {\n  // Encode password to ArrayBuffer\n  const passwordBytes = new TextEncoder().encode(password);\n\n  // Import password as a CryptoKey\n  const baseKey = await crypto.subtle.importKey(\n    \"raw\",\n    passwordBytes,\n    { name: \"PBKDF2\" },\n    false,\n    [\"deriveBits\", \"deriveKey\"],\n  );\n\n  return crypto.subtle.deriveKey(\n    {\n      name: \"PBKDF2\",\n      salt: salt as BufferSource,\n      iterations: 100000,\n      hash: \"SHA-256\",\n    },\n    baseKey,\n    {\n      name: \"AES-CTR\",\n      length: 256,\n    },\n    true, // extractable\n    [\"encrypt\", \"decrypt\"],\n  );\n}\n\nexport function importKey(b64EncodedKey: string): Promise<CryptoKey> {\n  return crypto.subtle.importKey(\n    \"raw\",\n    base64Decode(b64EncodedKey) as BufferSource,\n    { name: \"AES-CTR\" },\n    true,\n    [\"encrypt\", \"decrypt\"],\n  );\n}\n\nexport async function exportKey(ctrKey: CryptoKey): Promise<string> {\n  const key = await crypto.subtle.exportKey(\"raw\", ctrKey);\n  return base64Encode(new Uint8Array(key));\n}\n\nexport async function deriveGCMKeyFromCTR(\n  ctrKey: CryptoKey,\n): Promise<CryptoKey> {\n  const rawKey = await crypto.subtle.exportKey(\"raw\", ctrKey);\n  return crypto.subtle.importKey(\n    \"raw\",\n    rawKey,\n    { name: \"AES-GCM\" },\n    true,\n    [\"encrypt\", \"decrypt\"],\n  );\n}\n", "import { system } from \"@silverbulletmd/silverbullet/syscalls\";\n\nexport interface KrokiConfig {\n    server: string;\n}\n\nexport async function getKrokiConfig(): Promise<KrokiConfig> {\n    const config = await system.getConfig(\"kroki\", { server: \"https://kroki.io\" });\n    return {\n        server: config?.server || \"https://kroki.io\",\n    };\n}\n", "import { CodeWidgetContent } from \"@silverbulletmd/silverbullet/type/client\";\nimport { getKrokiConfig } from \"./krokiConfig.ts\";\n\nexport async function krokiWidget(bodyText: string, diagramType: string): Promise<CodeWidgetContent> {\n    const config = await getKrokiConfig();\n    const baseUrl = config.server;\n\n    const url = `${baseUrl}/${diagramType}/svg`;\n    console.log(`krokiWidget: Sending request to ${url} with body:`, bodyText);\n\n    const response = await httpPost(url, bodyText);\n\n    return {\n        html: `<pre id=\"${diagramType}\">${response}</pre>`,\n        script: `\n    document.addEventListener(\"click\", () => {\n      api({type: \"blur\"});\n    });\n    `,\n    };\n}\n\nasync function httpPost(url: string, bodyText: string): Promise<string> {\n    const response = await fetch(url, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"text/plain\" },\n        body: bodyText,\n    });\n\n    if (!response.ok) {\n        return `Error: HTTP ${response.status}`;\n    }\n\n    return await response.text();\n}", "import { krokiWidget } from \"./krokiBackend.ts\";\nimport { CodeWidgetContent } from \"@silverbulletmd/silverbullet/type/client\";\n\nexport async function krokiBlockdiagWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiBlockdiagWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'blockdiag');\n}\n\nexport async function krokiBpmnWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiBpmnWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'bpmn');\n}\n\nexport async function krokiBytefieldWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiBytefieldWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'bytefield');\n}\n\nexport async function krokiSeqdiagWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiSeqdiagWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'seqdiag');\n}\n\nexport async function krokiActdiagWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiActdiagWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'actdiag');\n}\n\nexport async function krokiNwdiagWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiNwdiagWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'nwdiag');\n}\n\nexport async function krokiPacketdiagWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiPacketdiagWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'packetdiag');\n}\n\nexport async function krokiRackdiagWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiRackdiagWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'rackdiag');\n}\n\nexport async function krokiC4plantumlWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiC4plantumlWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'c4plantuml');\n}\n\nexport async function krokiD2Widget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiD2Widget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'd2');\n}\n\nexport async function krokiDbmlWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiDbmlWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'dbml');\n}\n\nexport async function krokiDitaaWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiDitaaWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'ditaa');\n}\n\nexport async function krokiErdWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiErdWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'erd');\n}\n\nexport async function krokiGraphvizWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiGraphvizWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'graphviz');\n}\n\nexport async function krokiMermaidWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiMermaidWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'mermaid');\n}\n\nexport async function krokiNomnomlWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiNomnomlWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'nomnoml');\n}\n\nexport async function krokiPikchrWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiPikchrWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'pikchr');\n}\n\nexport async function krokiPumlWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiPumlWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'plantuml');\n}\n\nexport async function krokiStructurizrWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiStructurizrWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'structurizr');\n}\n\nexport async function krokiSvgbobWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiSvgbobWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'svgbob');\n}\n\nexport async function krokiSymbolatorWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiSymbolatorWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'symbolator');\n}\n\nexport async function krokiTikzWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiTikzWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'tikz');\n}\n\nexport async function krokiUmletWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiUmletWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'umlet');\n}\n\nexport async function krokiVegaWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiVegaWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'vega');\n}\n\nexport async function krokiVegaLiteWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiVegaLiteWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'vega-lite');\n}\n\nexport async function krokiWavedromWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiWavedromWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'wavedrom');\n}\n\nexport async function krokiWirevizWidget(\n  bodyText: string,\n  pageName: string\n): Promise<CodeWidgetContent> {\n  console.log('krokiWirevizWidget called with bodyText:', bodyText);\n  return krokiWidget(bodyText, 'wireviz');\n}\n\n", "\nimport { setupMessageListener } from \"https://deno.land/x/silverbullet@2.4.1/client/plugos/worker_runtime.ts\";\n\n// Imports\nimport {krokiBlockdiagWidget as krokiBlockdiagWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiBpmnWidget as krokiBpmnWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiBytefieldWidget as krokiBytefieldWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiSeqdiagWidget as krokiSeqdiagWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiActdiagWidget as krokiActdiagWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiNwdiagWidget as krokiNwdiagWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiPacketdiagWidget as krokiPacketdiagWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiRackdiagWidget as krokiRackdiagWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiC4plantumlWidget as krokiC4plantumlWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiD2Widget as krokiD2Widget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiDbmlWidget as krokiDbmlWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiDitaaWidget as krokiDitaaWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiErdWidget as krokiErdWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiGraphvizWidget as krokiGraphvizWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiMermaidWidget as krokiMermaidWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiNomnomlWidget as krokiNomnomlWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiPikchrWidget as krokiPikchrWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiPumlWidget as krokiPumlWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiStructurizrWidget as krokiStructurizrWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiSvgbobWidget as krokiSvgbobWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiSymbolatorWidget as krokiSymbolatorWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiTikzWidget as krokiTikzWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiUmletWidget as krokiUmletWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiVegaWidget as krokiVegaWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiVegaLiteWidget as krokiVegaLiteWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiWavedromWidget as krokiWavedromWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\nimport {krokiWirevizWidget as krokiWirevizWidget} from \"file:///home/vidalcor/projects/sb/sb-kroki/kroki.ts\";\n\n\n// Function mapping\nconst functionMapping = {\n  krokiBlockdiagWidget: krokiBlockdiagWidget,\n  krokiBpmnWidget: krokiBpmnWidget,\n  krokiBytefieldWidget: krokiBytefieldWidget,\n  krokiSeqdiagWidget: krokiSeqdiagWidget,\n  krokiActdiagWidget: krokiActdiagWidget,\n  krokiNwdiagWidget: krokiNwdiagWidget,\n  krokiPacketdiagWidget: krokiPacketdiagWidget,\n  krokiRackdiagWidget: krokiRackdiagWidget,\n  krokiC4plantumlWidget: krokiC4plantumlWidget,\n  krokiD2Widget: krokiD2Widget,\n  krokiDbmlWidget: krokiDbmlWidget,\n  krokiDitaaWidget: krokiDitaaWidget,\n  krokiErdWidget: krokiErdWidget,\n  krokiGraphvizWidget: krokiGraphvizWidget,\n  krokiMermaidWidget: krokiMermaidWidget,\n  krokiNomnomlWidget: krokiNomnomlWidget,\n  krokiPikchrWidget: krokiPikchrWidget,\n  krokiPumlWidget: krokiPumlWidget,\n  krokiStructurizrWidget: krokiStructurizrWidget,\n  krokiSvgbobWidget: krokiSvgbobWidget,\n  krokiSymbolatorWidget: krokiSymbolatorWidget,\n  krokiTikzWidget: krokiTikzWidget,\n  krokiUmletWidget: krokiUmletWidget,\n  krokiVegaWidget: krokiVegaWidget,\n  krokiVegaLiteWidget: krokiVegaLiteWidget,\n  krokiWavedromWidget: krokiWavedromWidget,\n  krokiWirevizWidget: krokiWirevizWidget,\n\n};\n\n// Manifest\nconst manifest = {\n  \"name\": \"kroki\",\n  \"version\": 0.1,\n  \"imports\": [\n    \"https://get.silverbullet.md/global.plug.json\"\n  ],\n  \"requiredPermissions\": [\n    \"fetch\"\n  ],\n  \"functions\": {\n    \"krokiBlockdiagWidget\": {\n      \"path\": \"./kroki.ts:krokiBlockdiagWidget\",\n      \"codeWidget\": \"kroki_blockdiag\"\n    },\n    \"krokiBpmnWidget\": {\n      \"path\": \"./kroki.ts:krokiBpmnWidget\",\n      \"codeWidget\": \"kroki_bpmn\"\n    },\n    \"krokiBytefieldWidget\": {\n      \"path\": \"./kroki.ts:krokiBytefieldWidget\",\n      \"codeWidget\": \"kroki_bytefield\"\n    },\n    \"krokiSeqdiagWidget\": {\n      \"path\": \"./kroki.ts:krokiSeqdiagWidget\",\n      \"codeWidget\": \"kroki_seqdiag\"\n    },\n    \"krokiActdiagWidget\": {\n      \"path\": \"./kroki.ts:krokiActdiagWidget\",\n      \"codeWidget\": \"kroki_actdiag\"\n    },\n    \"krokiNwdiagWidget\": {\n      \"path\": \"./kroki.ts:krokiNwdiagWidget\",\n      \"codeWidget\": \"kroki_nwdiag\"\n    },\n    \"krokiPacketdiagWidget\": {\n      \"path\": \"./kroki.ts:krokiPacketdiagWidget\",\n      \"codeWidget\": \"kroki_packetdiag\"\n    },\n    \"krokiRackdiagWidget\": {\n      \"path\": \"./kroki.ts:krokiRackdiagWidget\",\n      \"codeWidget\": \"kroki_rackdiag\"\n    },\n    \"krokiC4plantumlWidget\": {\n      \"path\": \"./kroki.ts:krokiC4plantumlWidget\",\n      \"codeWidget\": \"kroki_c4plantuml\"\n    },\n    \"krokiD2Widget\": {\n      \"path\": \"./kroki.ts:krokiD2Widget\",\n      \"codeWidget\": \"kroki_d2\"\n    },\n    \"krokiDbmlWidget\": {\n      \"path\": \"./kroki.ts:krokiDbmlWidget\",\n      \"codeWidget\": \"kroki_dbml\"\n    },\n    \"krokiDitaaWidget\": {\n      \"path\": \"./kroki.ts:krokiDitaaWidget\",\n      \"codeWidget\": \"kroki_ditaa\"\n    },\n    \"krokiErdWidget\": {\n      \"path\": \"./kroki.ts:krokiErdWidget\",\n      \"codeWidget\": \"kroki_erd\"\n    },\n    \"krokiGraphvizWidget\": {\n      \"path\": \"./kroki.ts:krokiGraphvizWidget\",\n      \"codeWidget\": \"kroki_graphviz\"\n    },\n    \"krokiMermaidWidget\": {\n      \"path\": \"./kroki.ts:krokiMermaidWidget\",\n      \"codeWidget\": \"kroki_mermaid\"\n    },\n    \"krokiNomnomlWidget\": {\n      \"path\": \"./kroki.ts:krokiNomnomlWidget\",\n      \"codeWidget\": \"kroki_nomnoml\"\n    },\n    \"krokiPikchrWidget\": {\n      \"path\": \"./kroki.ts:krokiPikchrWidget\",\n      \"codeWidget\": \"kroki_pikchr\"\n    },\n    \"krokiPumlWidget\": {\n      \"path\": \"./kroki.ts:krokiPumlWidget\",\n      \"codeWidget\": \"kroki_puml\"\n    },\n    \"krokiStructurizrWidget\": {\n      \"path\": \"./kroki.ts:krokiStructurizrWidget\",\n      \"codeWidget\": \"kroki_structurizr\"\n    },\n    \"krokiSvgbobWidget\": {\n      \"path\": \"./kroki.ts:krokiSvgbobWidget\",\n      \"codeWidget\": \"kroki_svgbob\"\n    },\n    \"krokiSymbolatorWidget\": {\n      \"path\": \"./kroki.ts:krokiSymbolatorWidget\",\n      \"codeWidget\": \"kroki_symbolator\"\n    },\n    \"krokiTikzWidget\": {\n      \"path\": \"./kroki.ts:krokiTikzWidget\",\n      \"codeWidget\": \"kroki_tikz\"\n    },\n    \"krokiUmletWidget\": {\n      \"path\": \"./kroki.ts:krokiUmletWidget\",\n      \"codeWidget\": \"kroki_umlet\"\n    },\n    \"krokiVegaWidget\": {\n      \"path\": \"./kroki.ts:krokiVegaWidget\",\n      \"codeWidget\": \"kroki_vega\"\n    },\n    \"krokiVegaLiteWidget\": {\n      \"path\": \"./kroki.ts:krokiVegaLiteWidget\",\n      \"codeWidget\": \"kroki_vega-lite\"\n    },\n    \"krokiWavedromWidget\": {\n      \"path\": \"./kroki.ts:krokiWavedromWidget\",\n      \"codeWidget\": \"kroki_wavedrom\"\n    },\n    \"krokiWirevizWidget\": {\n      \"path\": \"./kroki.ts:krokiWirevizWidget\",\n      \"codeWidget\": \"kroki_wireviz\"\n    }\n  },\n  \"assets\": {}\n};\n\nexport const plug = {manifest, functionMapping};\n\nsetupMessageListener(functionMapping, manifest, self.postMessage);\n"],
  "mappings": "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",
  "names": ["base64Decode", "s", "binString", "len", "bytes", "i", "base64Encode", "buffer", "binary", "fixedCounter", "Logger", "prefix", "maxCaptureSize", "createPatchedMethod", "level", "args", "prefixedArgs", "entry", "arg", "logEndpoint", "source", "logCopy", "e", "globalLogger", "initLogger", "workerPostMessage", "_msg", "runningAsWebWorker", "pendingRequests", "syscallReqId", "name", "args", "resolve", "reject", "setupMessageListener", "functionMapping", "manifest", "postMessageFn", "event", "data", "fn", "result", "e", "syscallId", "lookup", "initLogger", "sandboxFetch", "reqInfo", "options", "body", "encodedBody", "base64Encode", "monkeyPatchFetch", "init", "r", "base64Decode", "syscall", "name", "args", "system_exports", "__export", "cleanDatabases", "getBaseURI", "getConfig", "getMode", "getURLPrefix", "getVersion", "invokeCommand", "invokeFunction", "listCommands", "listSyscalls", "reloadPlugs", "wipeClient", "invokeFunction", "name", "args", "syscall", "invokeCommand", "listCommands", "listSyscalls", "reloadPlugs", "getMode", "getURLPrefix", "getBaseURI", "getVersion", "getConfig", "key", "defaultValue", "wipeClient", "logout", "cleanDatabases", "fixedCounter", "getKrokiConfig", "system_exports", "krokiWidget", "bodyText", "diagramType", "url", "getKrokiConfig", "response", "httpPost", "krokiBlockdiagWidget", "bodyText", "pageName", "krokiWidget", "krokiBpmnWidget", "krokiBytefieldWidget", "krokiSeqdiagWidget", "krokiActdiagWidget", "krokiNwdiagWidget", "krokiPacketdiagWidget", "krokiRackdiagWidget", "krokiC4plantumlWidget", "krokiD2Widget", "krokiDbmlWidget", "krokiDitaaWidget", "krokiErdWidget", "krokiGraphvizWidget", "krokiMermaidWidget", "krokiNomnomlWidget", "krokiPikchrWidget", "krokiPumlWidget", "krokiStructurizrWidget", "krokiSvgbobWidget", "krokiSymbolatorWidget", "krokiTikzWidget", "krokiUmletWidget", "krokiVegaWidget", "krokiVegaLiteWidget", "krokiWavedromWidget", "krokiWirevizWidget", "functionMapping", "krokiBlockdiagWidget", "krokiBpmnWidget", "krokiBytefieldWidget", "krokiSeqdiagWidget", "krokiActdiagWidget", "krokiNwdiagWidget", "krokiPacketdiagWidget", "krokiRackdiagWidget", "krokiC4plantumlWidget", "krokiD2Widget", "krokiDbmlWidget", "krokiDitaaWidget", "krokiErdWidget", "krokiGraphvizWidget", "krokiMermaidWidget", "krokiNomnomlWidget", "krokiPikchrWidget", "krokiPumlWidget", "krokiStructurizrWidget", "krokiSvgbobWidget", "krokiSymbolatorWidget", "krokiTikzWidget", "krokiUmletWidget", "krokiVegaWidget", "krokiVegaLiteWidget", "krokiWavedromWidget", "krokiWirevizWidget", "manifest", "plug", "setupMessageListener"]
}
